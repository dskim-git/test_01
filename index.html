<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>스네이크 게임 (단일 파일)</title>
  <style>
    :root {
      --bg: #0f1220;
      --panel: #171a2b;
      --grid: #131835;
      --snake: #5de8a3;
      --snake-head: #86ffc8;
      --food: #ffd76b;
      --food-edge: #ffcc3e;
      --text: #e9edf3;
      --muted: #9aa3b2;
      --danger: #ff6b6b;
      --primary: #3bbf85;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 800px at 50% -10%, #1c2246 0%, #0f1220 55%);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Noto Sans KR", sans-serif;
      padding: 20px;
    }
    .app {
      width: 100%;
      max-width: 540px;
      display: grid;
      gap: 14px;
    }
    header { text-align: center; }
    header h1 { margin: 0 0 4px; font-size: 1.4rem; }
    header p { margin: 0; color: var(--muted); font-size: .95rem; }
    .panel {
      background: var(--panel);
      border: 1px solid #222a50;
      border-radius: 12px;
      padding: 12px;
    }
    .toolbar {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 10px;
    }
    .scoreboard { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .badge {
      background: #111735;
      border: 1px solid #26306a;
      padding: 6px 10px;
      border-radius: 8px;
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; }
    .controls button, .controls select, .controls label {
      background: #111735;
      color: var(--text);
      border: 1px solid #26306a;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: .95rem;
    }
    .controls button.primary {
      background: linear-gradient(90deg, #2a9464, #3bbf85);
      border: none;
      color: #062013;
      font-weight: 600;
    }
    .controls button.warning {
      background: linear-gradient(90deg, #e25555, #ff7f7f);
      border: none;
      color: #2b0a0a;
      font-weight: 600;
    }
    canvas {
      width: 100%;
      height: auto;
      display: block;
      background: #0b0f20;
      border: 1px solid #222a50;
      border-radius: 12px;
    }
    .legend {
      margin-top: 8px;
      color: var(--muted);
      font-size: .9rem;
      line-height: 1.45;
    }
    footer { text-align: center; color: var(--muted); font-size: .85rem; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>스네이크 게임</h1>
      <p>조작: 키보드 화살표(↑ ↓ ← →) · Space: 일시정지/재개</p>
    </header>

    <!-- 상단 툴바 -->
    <div class="panel toolbar">
      <div class="scoreboard">
        <div class="badge">점수: <span id="score">0</span></div>
        <div class="badge">최고: <span id="best">0</span></div>
        <div class="badge">속도: <span id="spdLabel">보통</span></div>
        <div class="badge"><label><input type="checkbox" id="wrapToggle"> 래핑</label></div>
      </div>
      <div class="controls">
        <select id="speedSelect" title="난이도(속도)">
          <option value="6">느림</option>
          <option value="10" selected>보통</option>
          <option value="14">빠름</option>
        </select>
        <button id="startBtn" class="primary">시작</button>
        <button id="pauseBtn">일시정지</button>
        <button id="resetBtn" class="warning">리셋</button>
      </div>
    </div>

    <!-- 게임 보드 -->
    <div class="panel">
      <canvas id="board" width="420" height="420" aria-label="스네이크 게임 캔버스"></canvas>
      <div class="legend">
        ▸ 먹이를 먹으면 길어집니다. 벽/몸에 부딪히면 게임오버(래핑 체크 시 벽을 통과하여 반대편으로 등장).<br>
        ▸ Space로 일시정지/재개합니다. 키가 먹히지 않을 때는 캔버스를 한 번 클릭해 포커스를 주세요.
      </div>
    </div>

    <footer>© 2026 Snake • HTML/CSS/JS 단일 파일 구현</footer>
  </div>

  <script>
    // =========================
    // 기본 설정
    // =========================
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const spdLabel = document.getElementById('spdLabel');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const speedSelect = document.getElementById('speedSelect');
    const wrapToggle = document.getElementById('wrapToggle');

    // 보드 크기(격자)
    const COLS = 21; // 홀수로 두면 중앙 정렬이 자연스러움
    const ROWS = 21;
    const TILE = Math.floor(canvas.width / COLS); // 420/21=20px

    const COLORS = {
      grid: getComputedStyle(document.documentElement).getPropertyValue('--grid') || '#131835',
      bg: '#0b0f20',
      snake: getComputedStyle(document.documentElement).getPropertyValue('--snake') || '#5de8a3',
      snakeHead: getComputedStyle(document.documentElement).getPropertyValue('--snake-head') || '#86ffc8',
      food: getComputedStyle(document.documentElement).getPropertyValue('--food') || '#ffd76b',
      foodEdge: getComputedStyle(document.documentElement).getPropertyValue('--food-edge') || '#ffcc3e',
      gameOver: getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#ff6b6b',
      text: getComputedStyle(document.documentElement).getPropertyValue('--text') || '#e9edf3'
    };

    // 게임 상태
    let state = {
      running: false,
      paused: false,
      wrap: false,
      stepPerSec: 10,
      stepInterval: 1000 / 10,
      lastTime: 0,
      acc: 0,
      dir: { x: 1, y: 0 },     // 현재 진행 방향
      nextDir: { x: 1, y: 0 }, // 입력 버퍼
      snake: [],
      grow: 0,
      food: { x: 5, y: 5 },
      score: 0,
      best: Number(localStorage.getItem('snake_best') || 0),
      gameOver: false
    };

    // =========================
    // 유틸 함수
    // =========================
    const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const cellEq = (a, b) => a.x === b.x && a.y === b.y;
    const inBounds = (x, y) => x >= 0 && x < COLS && y >= 0 && y < ROWS;

    function setSpeed(sps) {
      state.stepPerSec = sps;
      state.stepInterval = 1000 / sps;
      spdLabel.textContent = sps <= 6 ? '느림' : sps >= 14 ? '빠름' : '보통';
    }

    function updateUI() {
      scoreEl.textContent = state.score;
      bestEl.textContent = state.best;
      pauseBtn.textContent = state.paused ? '재개' : '일시정지';
    }

    // =========================
    // 초기화 & 리셋
    // =========================
    function resetGame({ keepBest = true } = {}) {
      const cx = Math.floor(COLS / 2);
      const cy = Math.floor(ROWS / 2);
      state.snake = [
        { x: cx - 2, y: cy },
        { x: cx - 1, y: cy },
        { x: cx,     y: cy }
      ];
      state.dir = { x: 1, y: 0 };
      state.nextDir = { x: 1, y: 0 };
      state.grow = 0;
      state.score = 0;
      state.gameOver = false;
      state.paused = false;
      placeFood();
      state.lastTime = 0;
      state.acc = 0;
      if (!keepBest) {
        state.best = 0;
        localStorage.removeItem('snake_best');
      }
      updateUI();
      draw(); // 초기 프레임
    }

    function placeFood() {
      // 뱀 몸통이 아닌 칸에 랜덤 배치
      while (true) {
        const x = randInt(0, COLS - 1);
        const y = randInt(0, ROWS - 1);
        if (!state.snake.some(seg => seg.x === x && seg.y === y)) {
          state.food = { x, y };
          return;
        }
      }
    }

    // =========================
    // 입력(키보드 화살표만 지원)
    // =========================
    function setDirection(dx, dy) {
      const { x: cx, y: cy } = state.dir;
      // 180도 회전 방지
      if (dx === -cx && dy === -cy) return;
      state.nextDir = { x: dx, y: dy };
    }

    window.addEventListener('keydown', (e) => {
      const key = e.key;
      // 방향키일 경우 스크롤 방지
      if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(key)) {
        e.preventDefault();
      }
      if (key === 'ArrowUp') setDirection(0, -1);
      else if (key === 'ArrowDown') setDirection(0, 1);
      else if (key === 'ArrowLeft') setDirection(-1, 0);
      else if (key === 'ArrowRight') setDirection(1, 0);
      else if (key === ' ') togglePause();
    });

    // =========================
    // 메인 루프
    // =========================
    function gameLoop(ts) {
      if (!state.running) return;
      if (!state.lastTime) state.lastTime = ts;
      const dt = ts - state.lastTime;
      state.lastTime = ts;

      if (!state.paused && !state.gameOver) {
        state.acc += dt;
        while (state.acc >= state.stepInterval) {
          step();
          state.acc -= state.stepInterval;
        }
      }
      draw();
      requestAnimationFrame(gameLoop);
    }

    function step() {
      // 입력 버퍼 적용
      state.dir = state.nextDir;

      const head = state.snake[state.snake.length - 1];
      let nx = head.x + state.dir.x;
      let ny = head.y + state.dir.y;

      if (state.wrap) {
        // 래핑: 반대편으로 등장
        nx = (nx + COLS) % COLS;
        ny = (ny + ROWS) % ROWS;
      } else {
        // 벽 충돌: 게임오버
        if (!inBounds(nx, ny)) {
          doGameOver();
          return;
        }
      }

      const newHead = { x: nx, y: ny };

      // 자기 몸 충돌
      if (state.snake.some(seg => cellEq(seg, newHead))) {
        doGameOver();
        return;
      }

      // 이동
      state.snake.push(newHead);

      // 먹이 섭취
      if (cellEq(newHead, state.food)) {
        state.score += 1;
        state.grow += 1;
        if (state.score > state.best) {
          state.best = state.score;
          localStorage.setItem('snake_best', String(state.best));
        }
        placeFood();
      }

      // 성장 처리
      if (state.grow > 0) {
        state.grow -= 1;
      } else {
        state.snake.shift(); // 꼬리 제거
      }
    }

    function doGameOver() {
      state.gameOver = true;
      state.running = false;
      updateUI();
      draw(); // 최종 프레임
      setTimeout(() => {
        alert(`게임 오버!\n점수: ${state.score}\n[시작]으로 다시 플레이하세요.`);
      }, 50);
    }

    // =========================
    // 렌더링
    // =========================
    function clearBoard() {
      ctx.fillStyle = COLORS.bg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function drawGrid() {
      ctx.strokeStyle = COLORS.grid;
      ctx.lineWidth = 1;
      // 세로선
      for (let x = 0; x <= COLS; x++) {
        ctx.beginPath();
        ctx.moveTo(x * TILE + 0.5, 0);
        ctx.lineTo(x * TILE + 0.5, ROWS * TILE);
        ctx.stroke();
      }
      // 가로선
      for (let y = 0; y <= ROWS; y++) {
        ctx.beginPath();
        ctx.moveTo(0, y * TILE + 0.5);
        ctx.lineTo(COLS * TILE, y * TILE + 0.5);
        ctx.stroke();
      }
    }

    function drawCell(x, y, color) {
      const px = x * TILE;
      const py = y * TILE;
      const r = Math.max(2, Math.floor(TILE * 0.18));
      ctx.fillStyle = color;
      roundRect(px + 1, py + 1, TILE - 2, TILE - 2, r);
      ctx.fill();
    }

    function roundRect(x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.arcTo(x + w, y, x + w, y + h, r);
      ctx.arcTo(x + w, y + h, x, y + h, r);
      ctx.arcTo(x, y + h, x, y, r);
      ctx.arcTo(x, y, x + w, y, r);
      ctx.closePath();
    }

    function draw() {
      clearBoard();
      drawGrid();

      // 먹이
      drawCell(state.food.x, state.food.y, COLORS.food);
      // 먹이 하이라이트 테두리
      ctx.strokeStyle = COLORS.foodEdge;
      ctx.lineWidth = 1.4;
      ctx.strokeRect(state.food.x * TILE + 4, state.food.y * TILE + 4, TILE - 8, TILE - 8);

      // 뱀
      for (let i = 0; i < state.snake.length; i++) {
        const seg = state.snake[i];
        const isHead = i === state.snake.length - 1;
        drawCell(seg.x, seg.y, isHead ? COLORS.snakeHead : COLORS.snake);
      }

      // 게임오버 오버레이
      if (state.gameOver) {
        ctx.fillStyle = 'rgba(15,18,32,0.78)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = COLORS.gameOver;
        ctx.font = 'bold 28px system-ui, Segoe UI, Noto Sans KR, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 6);
        ctx.fillStyle = COLORS.text;
        ctx.font = '16px system-ui, Segoe UI, Noto Sans KR, sans-serif';
        ctx.fillText(`점수: ${state.score} / 최고: ${state.best}`, canvas.width / 2, canvas.height / 2 + 18);
      }

      updateUI();
    }

    // =========================
    // 컨트롤
    // =========================
    function startGame() {
      if (!state.running || state.gameOver) {
        resetGame({ keepBest: true });
        state.wrap = wrapToggle.checked;
        setSpeed(Number(speedSelect.value));
        state.running = true;
        state.paused = false;
        updateUI();
        canvas.focus();
        requestAnimationFrame(gameLoop);
      }
    }

    function togglePause() {
      if (!state.running || state.gameOver) return;
      state.paused = !state.paused;
      updateUI();
    }

    function resetAll() {
      state.running = false;
      resetGame({ keepBest: true });
    }

    startBtn.addEventListener('click', startGame);
    pauseBtn.addEventListener('click', togglePause);
    resetBtn.addEventListener('click', resetAll);
    speedSelect.addEventListener('change', () => setSpeed(Number(speedSelect.value)));
    wrapToggle.addEventListener('change', () => state.wrap = wrapToggle.checked);

    // 최초 1회 렌더
    resetGame({ keepBest: true });
  </script>
</body>
</html>
